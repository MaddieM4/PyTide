<html>
	<head>
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<link rel="stylesheet" type="text/css" href="css/textbutton.css">
		<link rel="stylesheet" type="text/css" href="css/searchinput.css">
		<link rel="stylesheet" type="text/css" href="css/toolbar.css">
		<link rel="stylesheet" type="text/css" href="css/menu.css">
		<link rel="stylesheet" type="text/css" href="css/contact.css">

		<style type="text/css">
			#footer .find  {
				float:left;
				position:relative;
				top:-1px;
				left:-5px;
				height:25px;
				width:180px;
				padding-left:3px;
			}

			#footer .find.inactive {
				color: #888;
			}

			#footer .over {width:255px;}

			#nav .top {height:24px;}
		</style>
		<script type="text/javascript" src="jslib/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="jslib/comm.js"></script>
		<script type="text/javascript">
			options = {}
		</script>
	</head>

	<body class ="noselect">
		<div id="nav">
			<div class="top">
				<table class="textbutton noselect"><tr>
					<td class="left"></td>
					<td class="center">+</td>
					<td class="right"/>
				</tr></table>
				</div>
			</div>
			<div class="toolbar noselect">
				<ul class="invisible select">
					<li class="arrow"><div>Next</div></li>
					<li class="pencil"><div>Edit</div></li>
					<li class="eye-open"><div>Mark as Unread</div></li>
					<li class="storage"><div>Shove</div></li>
					<li class="folder"><div>Folderize</div></li>
					<li class="more">...</li>
				</ul>
				<ul class="nonselect">
					<li class="arrow"><div>Next</div></li>
					<li class="inbox gotoInbox"><div>Inbox</div></li>
					<li class="storage gotoArchive"><div>Archive</div></li>
					<li class="eye-open"><div>Unfollow</div></li>
					<li class="arrow"><div>Jump</div></li>
					<li class="eye-open"><div>Document Mode</div></li>
					<li class="more">...</li>
				</ul>
				<ul class="edit invisible">
					<li class="icon-only bold"><div></div></li>
					<li class="icon-only italic"><div></div></li>
					<li class="icon-only underline"><div></div></li>
					<li class="noicon"><div>Style</div></li>
					<li class="icon-only bullets"><div></div></li>
					<li class="icon-only indent-more"><div></div></li>
					<li class="icon-only indent-less"><div></div></li>
					<li class="icon-only justify-left"><div></div></li>
					<li class="paperclip"><div>Insert</div></li>
					<li class="more">...</li>
				</ul>
			</div>
		</div>
		<div id="footer">
		<div class="footerinner">
			<div class="tags">
				<div class="label">Tags:</div> 
				<a href="#">Sample Tag</a>
				<a href="#">Other Sample tag</a>
				<input type="button" class="plusbutton_small"/>
			</div>
			<div class="jumps invisible">
				<div class="label">Jump:</div> 
				<a href="#">80's songs</a>
				<a href="#">Classic Scifi</a>
				<input type="button" class="plusbutton_small"/>
			</div>
			<div class="over">
			<input class="find inactive" value="Find"/>
			<table class="textbutton noselect">
				<td class="left"></td>
				<td class="center">Next Wave</td>
				<td class="right"></td>
			</table>
			</div>
		</div>
		</div>

	<script type="text/javascript" src="jslib/searchinput.js"></script>
	<script type="text/javascript" src="jslib/toolbar.js"></script>
	<script type="text/javascript" src="jslib/button.js"></script>
	<script type="text/javascript" src="jslib/contact.js"></script>
	<script type="text/javascript" src="jslib/menu.js"></script>
	<script type="text/javascript">
		function checkSelect() {
			if ($('#mainlist li.selected .contact').length >0){
				$("#nav .toolbar .contactselect").removeClass("invisible")
				$("#nav .toolbar .select").addClass("invisible")				
				$("#nav .toolbar .nonselect").addClass("invisible")				
			} else if ($('#mainlist li.selected').length >0){
				$("#nav .toolbar .contactselect").addClass("invisible")				
				$("#nav .toolbar .select").removeClass("invisible")
				$("#nav .toolbar .nonselect").addClass("invisible")
			} else {
				$("#nav .toolbar .contactselect").addClass("invisible")				
				$("#nav .toolbar .select").addClass("invisible")
				$("#nav .toolbar .nonselect").removeClass("invisible")
			}
			adj_toolbar();
		}

		function openOptions() {
			if ($('.toolbar .gotoOptions').hasClass('active')) {
				$('.toolbar .gotoOptions').removeClass('active');
				closeMenu();
			} else {
				$('.toolbar .gotoOptions').addClass('active');
				html = "<h2>Options:</h2>";
				openMenu(html,-2, function() {
					$('.toolbar .gotoOptions').removeClass('active');
					closeMenu();
				});
			}
		}

		$('.toolbar .more').click(function() {
			if ($(this).hasClass("active")) {
				closeMenu();
				$(this).removeClass("active");
				adj_toolbar();
			} else {
				openMenu("<ul class='tools'>"+pullTools()+"</ul>",3, function (){
					$('.toolbar .more').removeClass('active');
					closeMenu();
				});
				activateToolbars(true);
				$(this).addClass("active");
				$('.toolbar .gotoOptions').removeClass("active");
			}
		});

		buttons = $('.textbutton');
		toolbarbuttons = $('.toolbar li');

		// Button graphics handling for all textbuttons
		buttons.mousedown(function(){
			$(this).addClass("depressed")
		});
		buttons.mouseup(function(){
			$(this).removeClass("depressed")
		});
		buttons.mouseleave(function(){
			$(this).removeClass("depressed")
		});

		// toolbar hover
		toolbarbuttons.mouseenter(function () {
			$(this).addClass("over");
		});

		toolbarbuttons.mousedown(function(){
			$(this).addClass("down");
		});

		toolbarbuttons.mouseup(function() {
			$(this).removeClass("down");
		});

		toolbarbuttons.mouseleave(function(){
			$(this).removeClass("over").removeClass("down");
		});

		$('#footer .label').click(function () {
			if ($('#footer .tags').hasClass('invisible')) {
				$('#footer .tags').removeClass('invisible');
				$('#footer .jumps').addClass('invisible');
			} else {
				$('#footer .tags').addClass('invisible');
				$('#footer .jumps').removeClass('invisible');
			}
		});

		// switch toolbar depending on selection state
		function initListSelectability() {
			$('#mainlist li').mousedown(function(){
				$(this).toggleClass('selected');
				sendObject({"type":"waveSelected",
					"value":$(this).hasClass('selected')});
				checkSelect();
			});
		}

		initListSelectability()

		function reloadList(newlist) {
			results = newlist;
			querytext = results['query'];
			searchbox.val(querytext);
			$('.toolbar .active').removeClass('active');
			switch(querytext) {
				case "in:inbox":
					$('.toolbar .gotoInbox').addClass('active');
					break;
				case "in:all":
					$('.toolbar .gotoArchive').addClass('active');
					break;
				case "::contacts":
					$('.toolbar .gotoContacts').addClass('active');
					break;
			}
			digests = results['digests'];
			$('#mainlist li').remove();
			for (i in digests) {
				digest = digests[i];
				$(renderDigest(digest)).appendTo('#mainlist');
				}
			initListSelectability()
		}

		shortmonths = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
		function renderTime(ms) {
			var s = parseInt(ms)/1000;
			var d = new Date(parseInt(ms));
			if (new Date() - d > 1000*60*60*24) {
				// more than a day of difference
				return shortmonths[d.getMonth()]+" " +d.getDate();
			} else {
				// less than a day, show time
				return ""+d.getHours()+":"+d.getMinutes();
			}
		}

		function renderDigest(digest) {
			item = "<li><div class='name'>"+digest['title']+"</div>";
			participantlist = digest['participants']
			item+= "<table class='details'><tr><td><table><tr><td class='participants'><div>"
			for (i in participantlist) {
				part = participantlist[i];
				item += "<img class='online' alt='"+part['nick']+"' src='"+part['avatar']+"'/>"
			}
			item+="</div></td>";
			// don't include a TD for tags at this point
			item+="</tr></table></td>";
			item+="<td class='date'>"+renderTime(digest['date']);
			if (digest['unread'] == 0) {
				item+='<div class="msgs">'+digest['total']+" msgs</div></td></tr></table></li>";
			} else {
				item+='<div class="msgs"><div class="unread">'+digest['unread']+"</div> of "+digest['total']+"</div></td></tr></table></li>";
			}
			// alert(item)
			return item;
		}

		function contactsList(contacts) {
			//alert(JSON.stringify(contacts));
			$('.toolbar li').removeClass('active');
			$('.toolbar .gotoContacts').addClass('active');
			$('#mainlist li').remove();
			for (i in contacts) {				
				$('<li></li>').append(renderContact(contacts[i])).appendTo('#mainlist');
			}
			initListSelectability()
		}

		function query() {
			sendObject({
				'type':'query',
				'value':searchbox.val()
			});
		}

		$('#nav .search .right').click(function () {
			query();
		});

		searchbox.keypress(function(event) {
			if (event.keyCode=='13') query();
		});

		query();

		function query_nav(str) {
			searchbox.val(str);
			query();
		}

		function activateToolbars(menuonly){
			prefix = (menuonly) ? ".menu ":"";
			$(prefix+'li.gotoInbox').click(function () {query_nav("in:inbox")});
			$(prefix+'li.gotoArchive').click(function () {query_nav("in:all")});
			$(prefix+'li.gotoContacts').click(function () {query_nav("::contacts")});
			$(prefix+'li.gotoOptions').click(function () {openOptions()});
			$('.menu .tools li').click(function (){$('.toolbar .more').removeClass('active');});
		}

		activateToolbars(false);
	</script>

	</body>
</html>
